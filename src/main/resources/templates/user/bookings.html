<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('My Bookings')}"></head>
<body>
    <nav th:replace="~{fragments/layout :: navbar}"></nav>
    
    <section class="section">
        <div class="container">
            <h1 class="mb-4">üìã My Bookings</h1>
            
            <div th:replace="~{fragments/layout :: alerts}"></div>
            
            <div class="d-flex gap-2 flex-wrap mb-5">
                <button class="gallery-tab active" data-tab="darshan">Darshan Bookings</button>
                <button class="gallery-tab" data-tab="pooja">Pooja Bookings</button>
                <button class="gallery-tab" data-tab="tour">Tour Bookings</button>
            </div>
            
            <!-- Darshan Bookings -->
            <div id="darshan-tab" class="tab-content">
                <h3 class="mb-3">üôè Darshan Bookings</h3>
                <div th:if="${darshanBookings != null && !darshanBookings.isEmpty()}" class="temple-grid">
                    <div th:each="booking : ${darshanBookings}" class="card">
                        <div class="card-body">
                            <div class="d-flex justify-between align-center mb-2">
                                <span class="status-badge" 
                                      th:classappend="'status-' + ${booking.status?.name()?.toLowerCase() ?: 'pending'}"
                                      th:text="${booking.status ?: 'PENDING'}">Status</span>
                                <small th:text="'#' + ${booking.bookingNumber}">Booking#</small>
                            </div>
                            <h4 th:text="${booking.darshan.temple.name}">Temple</h4>
                            <p class="text-muted" th:text="${booking.darshan.name}">Darshan</p>
                            <div class="pooja-info">
                                <i class="fas fa-calendar"></i>
                                <span th:text="${booking.bookingDate}">Date</span>
                            </div>
                            <div class="pooja-info">
                                <i class="fas fa-users"></i>
                                <span th:text="${booking.numberOfPersons + ' person(s)'}">Persons</span>
                            </div>
                            <div class="pooja-info">
                                <i class="fas fa-rupee-sign"></i>
                                <span th:text="${booking.totalAmount != null ? '‚Çπ' + booking.totalAmount : 'FREE'}">Amount</span>
                            </div>
                            <div class="mt-3">
                                <a th:href="@{/user/bookings/darshan/{id}(id=${booking.id})}" class="btn btn-outline btn-sm">View Details</a>
                                <button th:if="${booking.status?.name() == 'PENDING' || booking.status?.name() == 'CONFIRMED'}"
                                        onclick="cancelBooking('darshan', this.dataset.id)" 
                                        th:data-id="${booking.id}"
                                        class="btn btn-sm" style="color: #C62828;">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div th:if="${darshanBookings == null || darshanBookings.isEmpty()}" class="text-center py-5">
                    <p class="text-muted">No darshan bookings found</p>
                </div>
            </div>
            
            <!-- Pooja Bookings -->
            <div id="pooja-tab" class="tab-content" style="display: none;">
                <h3 class="mb-3">üî• Pooja Bookings</h3>
                <div th:if="${poojaBookings != null && !poojaBookings.isEmpty()}" class="temple-grid">
                    <div th:each="booking : ${poojaBookings}" class="card">
                        <div class="card-body">
                            <div class="d-flex justify-between align-center mb-2">
                                <span class="status-badge" 
                                      th:classappend="'status-' + ${booking.status?.name()?.toLowerCase() ?: 'pending'}"
                                      th:text="${booking.status ?: 'PENDING'}">Status</span>
                                <small th:text="'#' + ${booking.bookingNumber}">Booking#</small>
                            </div>
                            <h4 th:text="${booking.pooja.temple.name}">Temple</h4>
                            <p class="text-muted" th:text="${booking.pooja.name}">Pooja</p>
                            <div class="pooja-info">
                                <i class="fas fa-calendar"></i>
                                <span th:text="${booking.bookingDate}">Date</span>
                            </div>
                            <div class="pooja-info">
                                <i class="fas fa-user"></i>
                                <span th:text="${booking.devoteeName}">Devotee</span>
                            </div>
                            <div class="pooja-info">
                                <i class="fas fa-rupee-sign"></i>
                                <span th:text="'‚Çπ' + ${booking.amount}">Amount</span>
                            </div>
                            <div class="mt-3">
                                <a th:href="@{/user/bookings/pooja/{id}(id=${booking.id})}" class="btn btn-outline btn-sm">View Details</a>
                                <button th:if="${booking.status?.name() == 'PENDING' || booking.status?.name() == 'CONFIRMED'}"
                                        onclick="cancelBooking('pooja', this.dataset.id)" 
                                        th:data-id="${booking.id}"
                                        class="btn btn-sm" style="color: #C62828;">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div th:if="${poojaBookings == null || poojaBookings.isEmpty()}" class="text-center py-5">
                    <p class="text-muted">No pooja bookings found</p>
                </div>
            </div>
            
            <!-- Tour Bookings -->
            <div id="tour-tab" class="tab-content" style="display: none;">
                <h3 class="mb-3">üë§ Tour Guide Bookings</h3>
                <div th:if="${tourBookings != null && !tourBookings.isEmpty()}" class="temple-grid">
                    <div th:each="booking : ${tourBookings}" class="card">
                        <div class="card-body">
                            <div class="d-flex justify-between align-center mb-2">
                                <span class="status-badge" 
                                      th:classappend="'status-' + ${booking.status?.name()?.toLowerCase() ?: 'pending'}"
                                      th:text="${booking.status ?: 'PENDING'}">Status</span>
                                <small th:text="'#' + ${booking.bookingNumber}">Booking#</small>
                            </div>
                            <h4 th:text="${booking.tourGuide.name}">Guide</h4>
                            <p class="text-muted" th:text="${booking.tourGuide.temple.name}">Temple</p>
                            <div class="pooja-info">
                                <i class="fas fa-calendar"></i>
                                <span th:text="${booking.tourDate}">Date</span>
                            </div>
                            <div class="pooja-info">
                                <i class="fas fa-clock"></i>
                                <span th:text="${booking.tourType?.displayName ?: 'Tour'}">Type</span>
                            </div>
                            <div class="pooja-info">
                                <i class="fas fa-rupee-sign"></i>
                                <span th:text="'‚Çπ' + ${booking.totalAmount}">Amount</span>
                            </div>
                            <div class="mt-3">
                                <a th:href="@{/user/bookings/tour/{id}(id=${booking.id})}" class="btn btn-outline btn-sm">View Details</a>
                                <button th:if="${booking.status?.name() == 'PENDING' || booking.status?.name() == 'CONFIRMED'}"
                                        onclick="cancelBooking('tour', this.dataset.id)" 
                                        th:data-id="${booking.id}"
                                        class="btn btn-sm" style="color: #C62828;">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div th:if="${tourBookings == null || tourBookings.isEmpty()}" class="text-center py-5">
                    <p class="text-muted">No tour bookings found</p>
                </div>
            </div>
        </div>
    </section>
    
    <script>
        document.querySelectorAll('[data-tab]').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('[data-tab]').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                this.classList.add('active');
                document.getElementById(this.dataset.tab + '-tab').style.display = 'block';
            });
        });
    </script>
    
    <footer th:replace="~{fragments/layout :: footer}"></footer>
    <div th:replace="~{fragments/layout :: scripts}"></div>
</body>
</html>

